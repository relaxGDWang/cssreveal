<!DOCTYPE html>
<html lang="zh" xmlns:v-on="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>垫片绘制</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
<style type="text/css">
*{ box-sizing:border-box;}
html,body{ padding:0; margin:0;}
svg{ border:1px solid #999; margin:10px;}
svg .backShow{ stroke:#666; fill:#fff;}
svg .sealing{ stroke:#000;}
svg .sealing:hover{ stroke:red; stroke-width:2;}
svg .sealing .partLeft{ fill:url(#leftPattern);}
svg .sealing .partRight{ fill:url(#rightPattern);}
svg .sealing rect{ fill:#ccc;}
svg pattern{ stroke:#333; stroke-width:1; fill:none;}
svg line{ stroke:#999; stroke-width:1;}
</style>
</head>
<body>
    <div class="show">
		<svg id="gasket" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1">
			<defs>
				<pattern id="myPattern" patternUnits="userSpaceOnUse">
				</pattern>
				<pattern id="leftPattern" xlink:href="#myPattern"></pattern>
				<pattern id="rightPattern" xlink:href="#myPattern"></pattern>
			</defs>
			<g class="grid">
				<line x1="50" y1="0" x2="50" y2="400"/>
				<line x1="100" y1="0" x2="100" y2="400"/>
				<line x1="150" y1="0" x2="150" y2="400"/>
				<line x1="200" y1="0" x2="200" y2="400"/>
				<line x1="250" y1="0" x2="250" y2="400"/>
				<line x1="300" y1="0" x2="300" y2="400"/>
				<line x1="350" y1="0" x2="350" y2="400"/>
				<line x1="400" y1="0" x2="400" y2="400"/>
				<line x1="450" y1="0" x2="450" y2="400"/>
				<line x1="500" y1="0" x2="500" y2="400"/>
				<line x1="550" y1="0" x2="550" y2="400"/>
				<line x1="600" y1="0" x2="600" y2="400"/>
				<line x1="650" y1="0" x2="650" y2="400"/>
				<line x1="700" y1="0" x2="700" y2="400"/>
				<line x1="750" y1="0" x2="750" y2="400"/>
				
				<line x1="0" y1="50" x2="800" y2="50"/>
				<line x1="0" y1="100" x2="800" y2="100"/>
				<line x1="0" y1="150" x2="800" y2="150"/>
				<line x1="0" y1="200" x2="800" y2="200"/>
				<line x1="0" y1="250" x2="800" y2="250"/>
				<line x1="0" y1="300" x2="800" y2="300"/>
				<line x1="0" y1="350" x2="800" y2="350"/>
			</g>
		</svg>
	</div>
<script src="jquery-1.12.4.min.js"></script>
<script>
var allW=800;
var allH=400;
var svg=$('#gasket')[0];
svg.setAttribute('width',allW);
svg.setAttribute('height',allH);

var gasket={d1:100,d2:180,d3:420,d4:600,E:60,e:42};
var g=drawGasketA('D',gasket);

//居中g
var mw=(allW-gasket.d4)/2;
var mh=(allH-gasket.E)/2;
//g.setAttribute('transform','translate('+mw+' '+mh+')');
svg.appendChild(g);

var ph=drawPattern(30,10);
//居中图案
$('#leftPattern')[0].setAttribute('patternTransform','translate(0,-'+(ph-gasket.E)/2+')');
$('#rightPattern')[0].setAttribute('patternTransform','translate(5,-'+(ph-gasket.E)/2+') rotate(180)');


//绘制底纹
function drawPattern(w,perW,angle){
	if (!angle) angle=60;
	var pattern=$('#myPattern')[0];
	var g=createPath('g');
	var count=w/perW*2+1;
	var h=Math.tan(Math.PI/180*60)*w;
	var p=[];
	p[0]=[[0,0],[-w,h],[0,h*2]];
	for (let i=1; i<count; i++){
		p[i]=[[],[],[]];
		for (let j=0; j<p[i].length; j++){
			let temp=p[i][j]=[];
			temp[0]=p[0][j][0]+perW*i;
			temp[1]=p[0][j][1];
		}
	}
	for (let i=0; i<count; i++){
		p[i][0]=p[i][0].join(',');
		p[i][1]=p[i][1].join(',');
		p[i][2]=p[i][2].join(',');
		p[i]=p[i].join(' ');
		let temp=createPath('polyline',{
			points: p[i]
		});
		g.appendChild(temp);
	}
	pattern.appendChild(g);
	pattern.setAttribute('width',w);
	pattern.setAttribute('height',h*2);
	pattern.setAttribute('viewbox','0 0 '+w+' '+h*2);
	return h*2;
}


//建立svg标签对象
function createPath(name,attr){
	var temp=document.createElementNS('http://www.w3.org/2000/svg',name);
	for (let x in attr){
		temp.setAttribute(x,attr[x]);
	}
	return temp;
}

//绘制基本型垫片
//type A,B,C,D
//size d1,d2,d3,d4,E,e
function drawGasketA(type,size){
	var gAll=createPath('g',{class:'outframe'});
	var gSealing=createPath('g',{class:'sealing'});
	var gOutside=createPath('g',{class:'outside'});
	var gInside=createPath('g',{class:'inside'});
	
	//计算x轴方向侵入偏移
	var xp=size.e/2/Math.tan(Math.PI/180*60);
	var xp2=size.E/2/Math.tan(Math.PI/180*60);
	
	//绘制底部背景
	let pointsArray=markPoints({w:size.d3,h:size.E},'middle',{x:(size.d4-size.d3)/2-xp,y:0});
	var partMiddle=createPath('polygon',{
		points:pointsArray.join(' '),
		class:'backShow'
	});
	
	//绘制密封圈左侧
	var perGS=(size.d3-size.d2)/2;
	pointsArray=markPoints({w:perGS,h:size.E},'left',{x:(size.d4-size.d3)/2-xp,y:0});
	var partLeft=createPath('polygon',{
		class: 'partLeft',
		points:pointsArray.join(' ')
	});
	
	//绘制密封圈右侧
	pointsArray=markPoints({w:perGS,h:size.E},'right',{x:(size.d4-size.d3)/2-xp+size.d3-perGS,y:0});
	var partRight=createPath('polygon',{
		class: 'partRight',
		points:pointsArray.join(' ')
	});
	
	//绘制内环
	var ringIn=createRing(size,'insdie',{x:});
	
	gSealing.appendChild(partMiddle);
	gSealing.appendChild(partLeft);
	gSealing.appendChild(partRight);
	
	gAll.appendChild(gSealing);
	return gAll;
}

//size{w,h}   绘制缠绕垫片密封环
//op 箭头方向
//py{x,y} 偏移量
//angle 单层夹角
function markPoints(size,op,py,angle){
	if (!py) py={x:0,y:0};
	if (!angle) angle=60;
	
	var perY=size.h/2;
	var perX=perY/Math.tan(Math.PI/180*angle);
	var p=[];
	p[0]=[0,0];
	p[1]=[size.w,0];
	p[2]=[size.w,perY];
	p[3]=[size.w,size.h];
	p[4]=[0,size.h];
	p[5]=[0,perY];
	switch(op){
		case 'left':
			p[5][0]-=perX;
			p[2][0]-=perX;
			break;
		case 'right':
			p[5][0]+=perX;
			p[2][0]+=perX;
			break;
		case 'middle':
			p[5][0]-=perX;
			p[2][0]+=perX;
			break;
	}
	console.log(p);
	for (let i=0; i<p.length; i++){
		p[i][0]+=py.x;
		p[i][1]+=py.y;
		p[i]=p[i].join(',');
	}
	return p;
}

//建立内外环
function createRing(op,size){
	
	
	function setPoints(){
	}
}
//size{w,h}   绘制缠绕垫片内外环
//op 箭头方向
//py{x,y} 偏移量
//angle 单层夹角
function markPoints2(size,op,py,angle){
	if (!py) py={x:0,y:0};
	if (!angle) angle=60;
	
	var perY=size.h/2;
	var perX=perY/Math.tan(Math.PI/180*angle);
	var p=[];
	p[0]=[0,0];
	p[1]=[size.w,0];
	p[2]=[size.w,perY];
	p[3]=[size.w,size.h];
	p[4]=[0,size.h];
	p[5]=[0,perY];
	switch(op){
		case 'left':
			p[2][0]+=perX;
			break;
		case 'right':
			p[5][0]-=perX;
			break;
	}
	for (let i=0; i<p.length; i++){
		p[i][0]+=py.x;
		p[i][1]+=py.y;
		p[i]=p[i].join(',');
	}
	return p;
}
</script>
</body>
</html>